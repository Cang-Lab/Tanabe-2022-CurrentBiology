function Population_RDSDisp_Mouse()

%% Sessions
% ST_m057 (M)
Exper(1).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_Combined_MountainSort\output\metrics.json';
Exper(1).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_Combined_MountainSort\output\templates.mda';
Exper(1).CheckerBoard.File = 'L:\Seiji\Data\ST_m057\ST_m057_210803_124237.rhd';
Exper(1).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m057\20210803T121434-Drift Gratings.mat';
Exper(1).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_121431.mat';
Exper(1).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_121431_MountainSort\output\firings_precur3.mda';
Exper(1).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m057\20210803T122526-Drift Gratings.mat';
Exper(1).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_122524.mat';
Exper(1).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_122524_MountainSort\output\firings_precur4.mda';
Exper(1).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m057\20210803T113550-RandomDotStereogram.mat';
Exper(1).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_112431.mat';
Exper(1).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m057\ST_m057_210803_112431_MountainSort\output\firings_precur1.mda';

% ST_m058 (M)
Exper(2).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_Combined_MountainSort\output\metrics.json';
Exper(2).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_Combined_MountainSort\output\templates.mda';
Exper(2).CheckerBoard.File = 'L:\Seiji\Data\ST_m058\ST_m058_210804_110229.rhd';
Exper(2).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m058\20210804T112244-Drift Gratings.mat';
Exper(2).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_112242.mat';
Exper(2).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_112242_MountainSort\output\firings_precur2.mda';
Exper(2).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m058\20210804T113418-Drift Gratings.mat';
Exper(2).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_113416.mat';
Exper(2).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_113416_MountainSort\output\firings_precur3.mda';
Exper(2).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m058\20210804T111810-RandomDotStereogram.mat';
Exper(2).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_110652.mat';
Exper(2).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m058\ST_m058_210804_110652_MountainSort\output\firings_precur1.mda';

% ST_m059 (M)
Exper(3).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_Combined1_MountainSort\output\metrics.json';
Exper(3).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_Combined1_MountainSort\output\templates.mda';
Exper(3).CheckerBoard.File = 'L:\Seiji\Data\ST_m059\ST_m059_210804_145759.rhd';
Exper(3).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m059\20210804T140103-Drift Gratings.mat';
Exper(3).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_140100.mat';
Exper(3).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_140100_MountainSort\output\firings_precur1.mda';
Exper(3).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m059\20210804T142257-Drift Gratings.mat';
Exper(3).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_142255.mat';
Exper(3).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_142255_MountainSort\output\firings_precur3.mda';
Exper(3).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m059\20210804T142227-RandomDotStereogram.mat';
Exper(3).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_141107.mat';
Exper(3).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m059\ST_m059_210804_141107_MountainSort\output\firings_precur2.mda';

% ST_m061 Daytime (M)
Exper(4).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_Combined_MountainSort\output\metrics.json';
Exper(4).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_Combined_MountainSort\output\templates.mda';
Exper(4).CheckerBoard.File = 'L:\Seiji\Data\ST_m061\ST_m061_210813_112544.rhd';
Exper(4).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210813T103210-Drift Gratings.mat';
Exper(4).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_103207.mat';
Exper(4).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_103207_MountainSort\output\firings_precur2.mda';
Exper(4).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210813T104638-Drift Gratings.mat';
Exper(4).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_104635.mat';
Exper(4).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_104635_MountainSort\output\firings_precur3.mda';
Exper(4).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210813T103138-RandomDotStereogram.mat';
Exper(4).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_102010.mat';
Exper(4).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210813_102010_MountainSort\output\firings_precur1.mda';

% ST_m061 Evening
Exper(5).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_Combined_MountainSort\output\metrics.json';
Exper(5).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_Combined_MountainSort\output\templates.mda';
Exper(5).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m061\ST_m061_210814_010819.rhd';
Exper(5).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210814T001558-Drift Gratings.mat';
Exper(5).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_001556.mat';
Exper(5).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_001556_MountainSort\output\firings_precur2.mda';
Exper(5).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210814T002941-Drift Gratings.mat';
Exper(5).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_002939.mat';
Exper(5).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_002939_MountainSort\output\firings_precur3.mda';
Exper(5).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m061\20210814T001506-RandomDotStereogram.mat';
Exper(5).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_000239.mat';
Exper(5).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m061\ST_m061_210814_000239_MountainSort\output\firings_precur1.mda';

% ST_m062 (M)
Exper(6).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_Combined_MountainSort\output\metrics.json';
Exper(6).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_Combined_MountainSort\output\templates.mda';
Exper(6).CheckerBoard.File = 'L:\Seiji\Data\ST_m062\ST_m062_210816_150706.rhd';
Exper(6).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m062\20210816T141947-Drift Gratings.mat';
Exper(6).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_141942.mat';
Exper(6).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_141942_MountainSort\output\firings_precur2.mda';
Exper(6).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m062\20210816T142952-Drift Gratings.mat';
Exper(6).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_142948.mat';
Exper(6).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_142948_MountainSort\output\firings_precur3.mda';
Exper(6).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m062\20210816T141919-RandomDotStereogram.mat';
Exper(6).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_140757.mat';
Exper(6).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m062\ST_m062_210816_140757_MountainSort\output\firings_precur1.mda';

% ST_m063 (M)
Exper(7).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_Combined_MountainSort\output\metrics.json';
Exper(7).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_Combined_MountainSort\output\templates.mda';
Exper(7).CheckerBoard.File = 'L:\Seiji\Data\ST_m063\ST_m063_210819_140223.rhd';
Exper(7).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m063\20210819T131049-Drift Gratings.mat';
Exper(7).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_131046.mat';
Exper(7).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_131046_MountainSort\output\firings_precur2.mda';
Exper(7).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m063\20210819T132125-Drift Gratings.mat';
Exper(7).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_132121.mat';
Exper(7).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_132121_MountainSort\output\firings_precur3.mda';
Exper(7).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m063\20210819T131002-RandomDotStereogram.mat';
Exper(7).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_125826.mat';
Exper(7).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m063\ST_m063_210819_125826_MountainSort\output\firings_precur1.mda';

% ST_m066 Swith to probe 64D (M)
Exper(8).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_Combined_MountainSort\output\metrics.json';
Exper(8).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_Combined_MountainSort\output\templates.mda';
Exper(8).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m066\ST_m066_210831_114439.rhd';
Exper(8).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m066\20210831T120238-Drift Gratings.mat';
Exper(8).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_120236.mat';
Exper(8).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_120236_MountainSort\output\firings_precur2.mda';
Exper(8).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m066\20210831T121238-Drift Gratings.mat';
Exper(8).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_121235.mat';
Exper(8).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_121235_MountainSort\output\firings_precur3.mda';
Exper(8).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m066\20210831T120150-RandomDotStereogram.mat';
Exper(8).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_115026.mat';
Exper(8).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m066\ST_m066_210831_115026_MountainSort\output\firings_precur1.mda';

% ST_m067 (M)
Exper(9).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_Combined_MountainSort\output\metrics.json';
Exper(9).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_Combined_MountainSort\output\templates.mda';
Exper(9).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m067\ST_m067_210831_141129.rhd';
Exper(9).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m067\20210831T142903-Drift Gratings.mat';
Exper(9).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_142900.mat';
Exper(9).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_142900_MountainSort\output\firings_precur2.mda';
Exper(9).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m067\20210831T144530-Drift Gratings.mat';
Exper(9).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_144527.mat';
Exper(9).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_144527_MountainSort\output\firings_precur3.mda';
Exper(9).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m067\20210831T142830-RandomDotStereogram.mat';
Exper(9).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_141645.mat';
Exper(9).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m067\ST_m067_210831_141645_MountainSort\output\firings_precur1.mda';

% ST_m068 (M)
Exper(10).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_Combined_MountainSort\output\metrics.json';
Exper(10).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_Combined_MountainSort\output\templates.mda';
Exper(10).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m068\ST_m068_210901_114049.rhd';
Exper(10).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m068\20210901T115843-Drift Gratings.mat';
Exper(10).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_115841.mat';
Exper(10).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_115841_MountainSort\output\firings_precur2.mda';
Exper(10).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m068\20210901T120837-Drift Gratings.mat';
Exper(10).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_120835.mat';
Exper(10).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_120835_MountainSort\output\firings_precur3.mda';
Exper(10).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m068\20210901T115815-RandomDotStereogram.mat';
Exper(10).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_114634.mat';
Exper(10).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m068\ST_m068_210901_114634_MountainSort\output\firings_precur1.mda';

% ST_m069 (M)
Exper(11).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_Combined_MountainSort\output\metrics.json';
Exper(11).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_Combined_MountainSort\output\templates.mda';
Exper(11).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m069\ST_m069_210902_124031.rhd';
Exper(11).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m069\20210902T115347-Drift Gratings.mat';
Exper(11).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_115343.mat';
Exper(11).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_115343_MountainSort\output\firings_precur2.mda';
Exper(11).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m069\20210902T120345-Drift Gratings.mat';
Exper(11).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_120341.mat';
Exper(11).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_120341_MountainSort\output\firings_precur3.mda';
Exper(11).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m069\20210902T115309-RandomDotStereogram.mat';
Exper(11).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_114149.mat';
Exper(11).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m069\ST_m069_210902_114149_MountainSort\output\firings_precur1.mda';

% ST_m070 (M)
Exper(12).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_Combined_MountainSort\output\metrics.json';
Exper(12).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_Combined_MountainSort\output\templates.mda';
Exper(12).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m070\ST_m070_210903_123601.rhd';
Exper(12).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m070\20210903T114940-Drift Gratings.mat';
Exper(12).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_114937.mat';
Exper(12).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_114937_MountainSort\output\firings_precur2.mda';
Exper(12).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m070\20210903T115943-Drift Gratings.mat';
Exper(12).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_115940.mat';
Exper(12).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_115940_MountainSort\output\firings_precur3.mda';
Exper(12).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m070\20210903T114839-RandomDotStereogram.mat';
Exper(12).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_113721.mat';
Exper(12).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m070\ST_m070_210903_113721_MountainSort\output\firings_precur1.mda';

% ST_m071 (M)
Exper(13).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_Combined_MountainSort\output\metrics.json';
Exper(13).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_Combined_MountainSort\output\templates.mda';
Exper(13).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m071\ST_m071_210906_121436.rhd';
Exper(13).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m071\20210906T123540-Drift Gratings.mat';
Exper(13).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_123537.mat';
Exper(13).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_123537_MountainSort\output\firings_precur2.mda';
Exper(13).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m071\20210906T124538-Drift Gratings.mat';
Exper(13).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_124535.mat';
Exper(13).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_124535_MountainSort\output\firings_precur3.mda';
Exper(13).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m071\20210906T123444-RandomDotStereogram.mat';
Exper(13).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_122320.mat';
Exper(13).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m071\ST_m071_210906_122320_MountainSort\output\firings_precur1.mda';

% ST_m072 (M)
Exper(14).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_Combined_MountainSort\output\metrics.json';
Exper(14).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_Combined_MountainSort\output\templates.mda';
Exper(14).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m072\ST_m072_210923_130451.rhd';
Exper(14).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210923T120927-Drift Gratings.mat';
Exper(14).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_120923.mat';
Exper(14).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_120923_MountainSort\output\firings_precur2.mda';
Exper(14).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210923T122115-Drift Gratings.mat';
Exper(14).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_122110.mat';
Exper(14).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_122110_MountainSort\output\firings_precur3.mda';
Exper(14).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210923T120848-RandomDotStereogram.mat';
Exper(14).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_115713.mat';
Exper(14).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_115713_MountainSort\output\firings_precur1.mda';

% ST_m072 2nd day 
Exper(15).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_Combined_MountainSort\output\metrics.json';
Exper(15).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_Combined_MountainSort\output\templates.mda';
Exper(15).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m072\ST_m072_210924_142341.rhd';
Exper(15).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210924T133258-Drift Gratings.mat';
Exper(15).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210923_120923.mat';
Exper(15).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_133255_MountainSort\output\firings_precur2.mda';
Exper(15).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210924T134358-Drift Gratings.mat';
Exper(15).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_134355.mat';
Exper(15).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_134355_MountainSort\output\firings_precur3.mda';
Exper(15).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m072\20210924T133214-RandomDotStereogram.mat';
Exper(15).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_132051.mat';
Exper(15).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m072\ST_m072_210924_132051_MountainSort\output\firings_precur1.mda';

% ST_m073 1st day (F)
Exper(16).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_Combined_MountainSort\output\metrics.json';
Exper(16).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_Combined_MountainSort\output\templates.mda';
Exper(16).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m073\ST_m073_210928_162645.rhd';
Exper(16).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210928T153734-Drift Gratings.mat';
Exper(16).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_153731.mat';
Exper(16).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_153731_MountainSort\output\firings_precur2.mda';
Exper(16).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210928T154729-Drift Gratings.mat';
Exper(16).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_154726.mat';
Exper(16).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_154726_MountainSort\output\firings_precur3.mda';
Exper(16).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210928T153708-RandomDotStereogram.mat';
Exper(16).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_152550.mat';
Exper(16).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210928_152550_MountainSort\output\firings_precur1.mda';

% ST_m073 2nd day
Exper(17).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_Combined_MountainSort\output\metrics.json';
Exper(17).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_Combined_MountainSort\output\templates.mda';
Exper(17).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m073\ST_m073_210929_130322.rhd';
Exper(17).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210929T121306-Drift Gratings.mat';
Exper(17).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_121303.mat';
Exper(17).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_121303_MountainSort\output\firings_precur2.mda';
Exper(17).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210929T122300-Drift Gratings.mat';
Exper(17).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_122256.mat';
Exper(17).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_122256_MountainSort\output\firings_precur3.mda';
Exper(17).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m073\20210929T121240-RandomDotStereogram.mat';
Exper(17).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_120103.mat';
Exper(17).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m073\ST_m073_210929_120103_MountainSort\output\firings_precur1.mda';

% ST_m074 1st day (F)
Exper(18).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_Combined_MountainSort\output\metrics.json';
Exper(18).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_Combined_MountainSort\output\templates.mda';
Exper(18).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m074\ST_m074_210930_163327.rhd';
Exper(18).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20210930T154219-Drift Gratings.mat';
Exper(18).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_154216.mat';
Exper(18).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_154216_MountainSort\output\firings_precur2.mda';
Exper(18).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20210930T155231-Drift Gratings.mat';
Exper(18).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_155227.mat';
Exper(18).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_155227_MountainSort\output\firings_precur3.mda';
Exper(18).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20210930T154144-RandomDotStereogram.mat';
Exper(18).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_153018.mat';
Exper(18).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_210930_153018_MountainSort\output\firings_precur1.mda';

% ST_m074 2nd day
Exper(19).ClustMetric.File = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_Combined_MountainSort\output\metrics.json';
Exper(19).ClustTemplate.File = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_Combined_MountainSort\output\templates.mda';
Exper(19).CheckerBoard.File = 'L:\Jenny\Intan_data\ST_m074\ST_m074_211001_122516.rhd';
Exper(19).OriTun.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20211001T113741-Drift Gratings.mat';
Exper(19).OriTun.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_113737.mat';
Exper(19).OriTun.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_113737_MountainSort\output\firings_precur2.mda';
Exper(19).PhaseDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20211001T114740-Drift Gratings.mat';
Exper(19).PhaseDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_114737.mat';
Exper(19).PhaseDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_114737_MountainSort\output\firings_precur3.mda';
Exper(19).RDSDispar.StimFile = 'D:\Seiji Tanabe\Data\ST_m074\20211001T113705-RandomDotStereogram.mat';
Exper(19).RDSDispar.DigFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_112444.mat';
Exper(19).RDSDispar.FiringFile = 'D:\Seiji Tanabe\Data\ST_m074\ST_m074_211001_112444_MountainSort\output\firings_precur1.mda';

%% Loop through sessions. Load spike sorting cluster metrics.
for n = 1:length(Exper)
	x = jsondecode(fileread(Exper(n).ClustMetric.File));
	Exper(n).ClustMetric.Clusters = x.clusters;
	clear x;
end

%% Loop through sessions. Concatenate cluster metrics
ClustMetrics = zeros(1,4);
nclust = 0;
for n = 1:length(Exper)
	for m = 1:length(Exper(n).ClustMetric.Clusters)
		nclust = nclust +1;
		ClustMetrics(nclust,1) = n;
		ClustMetrics(nclust,2) = Exper(n).ClustMetric.Clusters(m).label;
		ClustMetrics(nclust,3) = Exper(n).ClustMetric.Clusters(m).metrics.isolation;
		ClustMetrics(nclust,4) = Exper(n).ClustMetric.Clusters(m).metrics.noise_overlap;
	end
end

figure;
plot(ClustMetrics(:,3),ClustMetrics(:,4),'.');
box off; axis square;
xlabel('Isolation'); ylabel('Noise overlap');

%% Loop through sessions. Load nnecessary data structure Trial. Create if it doesn't exist.
for n = 1:length(Exper)
	% Data for OriTun
	FileTrial = [Exper(n).OriTun.DigFile(1:end-4) '_Trial.mat'];
	if exist(FileTrial,'file')
		load(FileTrial,'Trial');
	else
		pos = strfind(Exper(n).OriTun.FiringFile,'firings');
		Trial = ParseSpikeTrain_MountainSort(Exper(n).OriTun.DigFile,Exper(n).OriTun.FiringFile(pos:end));
		save(FileTrial,'Trial');
	end
	Exper(n).OriTun.Stim = load(Exper(n).OriTun.StimFile);
	Exper(n).OriTun.Trial = Trial;
	Exper(n).OriTun.Tun = TuningFunc(Trial,'Ori_vs_OcularIndx',1);
	
	% Data for PhaseDispar
	FileTrial = [Exper(n).PhaseDispar.DigFile(1:end-4) '_Trial.mat'];
	if exist(FileTrial,'file')
		load(FileTrial,'Trial');
	else
		pos = strfind(Exper(n).PhaseDispar.FiringFile,'firings');
		Trial = ParseSpikeTrain_MountainSort(Exper(n).PhaseDispar.DigFile,Exper(n).PhaseDispar.FiringFile(pos:end));
		save(FileTrial,'Trial');
	end
	Exper(n).PhaseDispar.Stim = load(Exper(n).PhaseDispar.StimFile);
	Exper(n).PhaseDispar.Trial = Trial;
	Exper(n).PhaseDispar.Tun = TuningFunc(Trial,'PhaseDisparity_vs_Ori',1);
	
	% Data for RDSDispar
	FileTrial = [Exper(n).RDSDispar.DigFile(1:end-4) '_Trial.mat'];
	if exist(FileTrial,'file')
		load(FileTrial,'Trial');
	else
		pos = strfind(Exper(n).RDSDispar.FiringFile,'firings');
		Trial = ParseSpikeTrain_MountainSort(Exper(n).RDSDispar.DigFile,Exper(n).RDSDispar.FiringFile(pos:end));
		save(FileTrial,'Trial');
	end
	Exper(n).RDSDispar.Stim = load(Exper(n).RDSDispar.StimFile);
	Exper(n).RDSDispar.Trial = Trial;
	Exper(n).RDSDispar.Tun = TuningFunc(Trial,'Disparity',1,[-20:1:20]);
	
	% Spike template
	templ = readmda(Exper(n).ClustTemplate.File);
	if n<8
		probe = probe_64M_func;
	else
		probe = probe_64D_func;
	end
	[chanpos,chan_idx] = sortrows([probe.x probe.z]);
	Exper(n).ClustTemplate.Waveform = templ(chan_idx,:,:);
	Exper(n).ClustTemplate.ChanPos = chanpos;
	
	% LFP data for CheckerBoard
	pos = strfind(Exper(n).CheckerBoard.File,'ST_m');
	FileLFP = ['D:\Seiji Tanabe\Data\' Exper(n).CheckerBoard.File(pos:end-4) '_LFP.mat'];
	if exist(FileLFP,'file')
		load(FileLFP)
	else
		if n<7
			LFP = LFP_analysis(Exper(n).CheckerBoard.File);
		else
			LFP = LFP_analysis_64D(Exper(n).CheckerBoard.File);
		end
		save(FileLFP,'LFP');
		close;
	end
	Exper(n).CheckerBoard.LFP = LFP;
	Exper(n).CheckerBoard.ChanPos = chanpos;
end

%% Selection based on criterion
% Criteria
% 1. cluster metric noise overlap
% 2. cluster metric isolation
% 3. Visual resp 
CRIT_CLUSTNOISEOVERLAP = 0.07;
CRIT_CLUSTISOLATION = 0.96;
if exist('Population_RDSDisp_Mouse.mat','file')
	load('Population_RDSDisp_Mouse.mat','Exper');
else
	for n = 1:length(Exper)
		% Selection critera for RDSDispar data
		Tun = Exper(n).RDSDispar.Tun;
		for m = 1:length(Tun)
			mtr = zeros(1,2);
			mtr(1) = Exper(n).ClustMetric.Clusters(Tun(m).clust_idx).metrics.isolation;
			mtr(2) = Exper(n).ClustMetric.Clusters(Tun(m).clust_idx).metrics.noise_overlap;
			if mtr(1)>CRIT_CLUSTISOLATION && mtr(2)<CRIT_CLUSTNOISEOVERLAP
				flag_pass = RespCriterion(Tun(m));
			else
				flag_pass = false;
			end
			Exper(n).RDSDispar.crit_pass(m) = flag_pass;
		end
	end
	save('Population_RDSDisp_Mouse.mat','Exper');
end

%% Discard units that failed the selection criterion
for n = 1:length(Exper)
	m_sel = find(Exper(n).RDSDispar.crit_pass);
	Exper(n).RDSDispar.Tun = Exper(n).RDSDispar.Tun(m_sel);
	for m = 1:length(m_sel)
		clust_idx = Exper(n).RDSDispar.Tun(m).clust_idx;
		clust_ori = find([Exper(n).OriTun.Tun.clust_idx] == clust_idx);
		clust_phi = find([Exper(n).PhaseDispar.Tun.clust_idx] == clust_idx);
		if ~isempty(clust_ori)
			OriTun(m) = Exper(n).OriTun.Tun(clust_ori);
		end
		if ~isempty(clust_phi)
			PhiTun(m) = Exper(n).PhaseDispar.Tun(clust_phi);
		end
	end
	Exper(n).OriTun = rmfield(Exper(n).OriTun,'Tun');
	Exper(n).PhaseDispar = rmfield(Exper(n).PhaseDispar,'Tun');
	for m = 1:length(m_sel)
		Exper(n).OriTun.Tun(m) = OriTun(m);
		Exper(n).PhaseDispar.Tun(m) = PhiTun(m);
	end
	clear OriTun PhiTun;
end



%% Calculate tuning metrics for neurons that passed the selection criterion
Data = [];
for n = 1:length(Exper)
	Tun = Exper(n).RDSDispar.Tun;
	for m = 1:length(Tun)
		DDI = DisparDiscrimIndx(Tun(m).Count);
		[BII,Amp] = BinocInteractIndx(Tun(m).Resp);
		DTI = DisparityTuningIndx(Tun(m).Resp);
		binocmean = mean(Tun(m).Resp(1:end-3,1));
% 		chanpos = Exper(n).ClustTemplate.ChanPos;
% 		chanz = NeuronChanPosition(Exper(n).RDSDispar.FiringFile,Tun(m).clust_idx,chanpos);
		pos = strfind(Exper(n).RDSDispar.FiringFile,'firings');
		FiringFile = Exper(n).RDSDispar.FiringFile(pos:end);
		if n<8
			probe = probe_64M_func;
		else
			probe = probe_64D_func;
		end
		[~,chan_idx] = sortrows([probe.x probe.z]);
		[chanz,chanprim] = NeuronPrimaryChan(Exper(n).RDSDispar.DigFile,FiringFile,Tun(m).clust_idx,Exper(n).ClustTemplate.ChanPos);
		if n<8
			zbnd(1,:) = LFP_boundary(mean(Exper(n).CheckerBoard.LFP(1:32,:,:),3),sortrows(Exper(n).CheckerBoard.ChanPos(1:32,:)))';
			zbnd(2,:) = LFP_boundary(mean(Exper(n).CheckerBoard.LFP(33:64,:,:),3),sortrows(Exper(n).CheckerBoard.ChanPos(33:64,:)))';
			sinkz = mean(zbnd);
		else
			zbnd(1,:) = LFP_boundary(mean(Exper(n).CheckerBoard.LFP(1:21,:,:),3),sortrows(Exper(n).CheckerBoard.ChanPos(1:21,:)))';
			zbnd(2,:) = LFP_boundary(mean(Exper(n).CheckerBoard.LFP(22:43,:,:),3),sortrows(Exper(n).CheckerBoard.ChanPos(22:43,:)))';
			zbnd(3,:) = LFP_boundary(mean(Exper(n).CheckerBoard.LFP(44:64,:,:),3),sortrows(Exper(n).CheckerBoard.ChanPos(44:64,:)))';
			sinkz = mean(zbnd);
		end
		neuropos = chanz - sinkz(2);
		v = Exper(n).ClustTemplate.Waveform(chan_idx==chanprim,:,Tun(m).clust_idx);
		[spk_ptratio,spk_slope,v_norm] = SpikeWave(v,'Mouse');
		Data = [Data; n Tun(m).clust_idx Tun(m).Anova DDI BII DTI neuropos spk_slope(2) binocmean];
		clear zbnd probe chanpos chanz sinkz;
	end
	
end

figure; % DDI vs DTI
withDTI = Data(:,6)~=-1;
oh = plot(Data(withDTI,4),Data(withDTI,6),'ko'); hold on;
oh.MarkerFaceColor = oh.Color;
xlabel('DDI'); ylabel('DTI'); box off;

figure; % Histogram of DDI
SIGNIF = Data(:,3)<0.05;
histbin = [0:0.05:1];
DDI_hist(1,:) = histcounts(Data(SIGNIF,4),histbin);
DDI_hist(2,:) = histcounts(Data(~SIGNIF,4),histbin);
histcent = histbin(1:end-1)+(histbin(2)-histbin(1))/2;
oh = bar(histcent,DDI_hist','stacked');
oh(1).FaceColor = 'k'; oh(2).FaceColor = 'w'; box off;
ah = gca; ah.TickDir = 'out'; ah.FontSize=14;
xlabel('DDI'); ylabel('Num of neurons');
legend('ANOVA p<0.05','ANOVA p>0.05');
disp('hello');

figure; % Cell-type vs DDI
type_fs = Data(:,8)<0;
x_fs = randn(sum(type_fs),1)*0.1+1;
x_rs = randn(sum(~type_fs),1)*0.1+2;
oh = plot([x_fs; x_rs],[Data(type_fs,4); Data(~type_fs,4)],'ko'); hold on;
oh.MarkerFaceColor = oh.Color;
ylabel('DDI'); box off; ylim([0 1])
ah=gca; ah.FontSize=14; ah.XTick = [1 2]; ah.XTickLabel={'FS','RS'};

figure; % DDI vs BinocMean
oh = plot(Data(:,9),Data(:,4),'ko'); hold on;
oh.MarkerFaceColor = oh.Color;
xlabel('Binoc mean'); ylabel('DDI'); box off;


%% Plot and save figure
% for n = 2:length(Exper)
% 	clust_idx_dispar = [Exper(n).Test(3).Tun.clust_idx];
% 	CRIT_PASSID = find(Exper(n).Test(3).CRIT_PASS);
% 	for m = 3:length(CRIT_PASSID)
% 		figure
% 		
% 		% LFP
% 		subplot(3,2,1);
% 		SAMPLINGFREQ = 20000;
% 		TDUR = 0.25;
% 		LFP = mean(Exper(n).Test(1).LFP,3);
% 		chanpos = sortrows([Exper(n).Test(2).chanpos]);
% 		lfpmax = max(max(max(abs(LFP))));
% 		% Chans 1 - 32
% 		imagesc([1:TDUR*SAMPLINGFREQ]/SAMPLINGFREQ,chanpos(1:32,2),LFP(1:32,:),[-1 1]*lfpmax);
% 		axis xy; box off; ylim([chanpos([1 64],2)]);
% 		% Chans 33 - 64
% % 		imagesc([1:TDUR*SAMPLINGFREQ]/SAMPLINGFREQ,chanpos(33:64,2),LFP(33:64,:),[-1 1]*lfpmax);
% % 		axis xy; box off; ylim([chanpos([1 64],2)]);
% 	
% 		% Spike template
% % 		figure;
% 		subplot(3,2,2);
% 		T = [1:size(Exper(n).Test(2).Templates,2)] * 25/150;
% 		for k = 1:size(Exper(n).Test(2).Templates,1)
% 			h = plot(Exper(n).Test(2).chanpos(k,1)+T,Exper(n).Test(2).chanpos(k,2)+Exper(n).Test(2).Templates(k,:,CRIT_PASSID(m)),'k');
% 			hold on;
% 		end
% 		box off;
% 
% 		% Disp tuning
% % 		figure;
% 		subplot(3,2,4);
% 		if n~=3
% 			Dispar = Exper(n).Test(3).Stim.Disparity;
% 		else
% 			Dispar = Exper(n).Test(3).Stim.HoriDisparity;
% 		end
% 		errorbar(Dispar,squeeze(Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(1:end-3,1)),squeeze(Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(1:end-3,2)),...
% 			'o-'); hold on;
% 		errorbar(Dispar(end)+0.2,Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(end-2,1),Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(end-2,2),'<');
% 		errorbar(Dispar(end)+0.2,Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(end-1,1),Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(end-1,2),'>');
% 		plot([-1 1]*Dispar(end),Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp(end,1)*[1 1],'k--')
% 		xlabel('Disparity (deg)'); ylabel('Firing rate (spikes/s)'); box off;
% 		
% % 		DDI = DisparDiscrimIndx(Exper(n).Test(3).Tun(CRIT_PASSID(m)).Count);
% 		BII = BinocInteractIndx(Exper(n).Test(3).Tun(CRIT_PASSID(m)).Resp); title(['BII=' num2str(BII)]);
% 		
% 		% Ori tuning
% 		subplot(3,2,3);
% 		if ~isempty(find([Exper(n).Test(2).Tun.clust_idx]==clust_idx_dispar(CRIT_PASSID(m)),1))
% 			tun_idx = find([Exper(n).Test(2).Tun.clust_idx] == clust_idx_dispar(CRIT_PASSID(m)));
% 			errorbar(Exper(n).Test(2).Stim.Var1Range,squeeze(Exper(n).Test(2).Tun(tun_idx).Resp(1:2:23,1)),squeeze(Exper(n).Test(2).Tun(tun_idx).Resp(1:2:23,2)),...
% 				'o-'); hold on;
% 			errorbar(Exper(n).Test(2).Stim.Var1Range,squeeze(Exper(n).Test(2).Tun(tun_idx).Resp(2:2:24,1)),squeeze(Exper(n).Test(2).Tun(tun_idx).Resp(2:2:24,2)),...
% 				'o-');
% 			plot([0 360],Exper(n).Test(2).Tun(tun_idx).Resp(25,1)*[1 1],'k--')
% 		end
% 		xlabel('Orientation (deg)'); ylabel('Firing rate (spikes/s)'); box off;
% 		
% 		% Phase dispar
% 		subplot(3,2,5);
% 		if ~isempty(Exper(n).Test(5).FileData) && ~isempty(find([Exper(n).Test(5).Tun.clust_idx]==clust_idx_dispar(CRIT_PASSID(m)), 1))
% 			tun_idx = find([Exper(n).Test(5).Tun.clust_idx] == clust_idx_dispar(CRIT_PASSID(m)));
% 			errorbar(Exper(n).Test(5).Tun(tun_idx).Stim,squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(1:8,1)),squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(1:8,2)),'o-'); hold on;
% 			errorbar(Exper(n).Test(5).Tun(tun_idx).Stim,squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(9:16,1)),squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(9:16,2)),'o-');
% 			errorbar(Exper(n).Test(5).Tun(tun_idx).Stim,squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(17:24,1)),squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(17:24,2)),'o-');
% 			errorbar(Exper(n).Test(5).Tun(tun_idx).Stim,squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(25:32,1)),squeeze(Exper(n).Test(5).Tun(tun_idx).Resp(25:32,2)),'o-');
% 		end
% 		xlabel('Phase disparity (deg)'); ylabel('Firing rate (spikes/s)'); box off;
% 		
% 		% Raster PSTH
% % 		if ~isempty(Exper(n).Test(5).FileData) && ~isempty(find([Exper(n).Test(5).Tun.clust_idx]==clust_idx_dispar(CRIT_PASSID(m)),1))
% % 			[~,peakid] = max(Exper(n).Test(5).Tun(tun_idx).Resp(:,1));
% % 			RasterPSTH(Exper(n).Test(5).Trial,tun_idx,peakid);
% % 			xlabel('Time (s)');
% % 		end
% 		
% 		% RF map
% 		subplot(3,2,6);
% 		if ~isempty(find([Exper(n).Test(4).Tun.clust_idx]==clust_idx_dispar(CRIT_PASSID(m)),1))
% 			tun_idx = find([Exper(n).Test(4).Tun.clust_idx] == clust_idx_dispar(CRIT_PASSID(m)));
% 			imagesc(Exper(n).Test(4).Tun(tun_idx).Resp); hold on;
% 			Ngrid = Exper(n).Test(4).Stim.GridNum;
% 			plot(Ngrid*[1 1]+0.5,[0 2*Ngrid+0.5],'w'); plot([0 2*Ngrid+0.5],Ngrid*[1 1]+0.5,'w');
% 			axis off; axis square;
% 			ah=gca; ah.CLim=[-1 1] *max(abs(ah.CLim));
% 		end
% 			
% 
% 		if BII<0.3
% % 		if BII<0.7 && Exper(n).Test(3).Tun(CRIT_PASSID(m)).Anova<0.05
% % 		if DDI>0.55
% 			saveas(gcf,['DataTuningPlots\SelectCrit_OriDisp\LowBII_Exper_' num2str(n) '_Clust_' num2str(CRIT_PASSID(m)) '.png']);
% 		end
% 		close;
% 	end
% end

%% Population analysis
Data = [];
for n = 1:length(Exper)
	Tun = Exper(n).Test(3).Tun(Exper(n).Test(3).CRIT_PASS);
	clust_idx_dispar = [Tun.clust_idx];
	clust_idx_ori = [Exper(n).Test(2).Tun.clust_idx];
	for m = 1:length(clust_idx_dispar)
		idx_ori = find(clust_idx_ori==clust_idx_dispar(m));
		if ~isempty(idx_ori)
			TunOri(m) = Exper(n).Test(2).Tun(idx_ori);
		end
	end
% 	Tun = Exper(n).Test(2).Tun(Exper(n).Test(2).CRIT_PASS);
% 	clust_idx_ori = [Tun.clust_idx];
% 	clust_idx_dispar = [Exper(n).Test(3).Tun.clust_idx];
% 	for m = 1:length(clust_idx_ori)
% 		idx_dispar = find(clust_idx_dispar==clust_idx_ori(m));
% 		if ~isempty(idx_dispar)
% 			TunDispar(m) = Exper(n).Test(3).Tun(idx_dispar);
% 		end
% 	end
	TunOri = Tun;
	for m = 1:length(Tun)
		DDI = DisparDiscrimIndx(Tun(m).Count);
		[BII,Amp] = BinocInteractIndx(Tun(m).Resp);
		NeurPos = NeuronPosition(Exper(n).Test(2).Templates(:,:,Tun(m).clust_idx),Exper(n).Test(2).chanpos);
		zbnd(1,:) = LFP_boundary(mean(Exper(n).Test(1).LFP(1:32,:,:),3),sortrows(Exper(n).Test(2).chanpos(1:32,:)))';
		zbnd(2,:) = LFP_boundary(mean(Exper(n).Test(1).LFP(33:64,:,:),3),sortrows(Exper(n).Test(2).chanpos(33:64,:)))';
		monoc = Tun(m).Resp(end-2:end,1)';
		[~,chanprim] = max(var(Exper(n).Test(2).Templates(:,:,Tun(m).clust_idx),[],2));
		v = Exper(n).Test(2).Templates(chanprim,:,Tun(m).clust_idx);
		[spk_ptratio,spk_slope] = SpikeWave(v,'Mouse');
		[~,idx_ori] = intersect(clust_idx_ori, clust_idx_dispar(m));
		if ~isempty(TunOri(m).Resp)
			[RDomEye,OculDom] = max([max(TunOri(m).Resp(1:2:23,1)) max(TunOri(m).Resp(2:2:24,1))]);
			if OculDom==1 % L-eye dominant
				TunOriMonoc = TunOri(m).Resp(1:2:23,1) - TunOri(m).Resp(end,1);
			elseif OculDom==2 % R-eye dominant
				TunOriMonoc = TunOri(m).Resp(2:2:24,1) - TunOri(m).Resp(end,1);
			end
			[prefD prefO gOSI gDSI]  = prefDOgOSIgDSI(TunOriMonoc);
		else
			gOSI = NaN;
		end
		if n~=3
			prefDispar = DisparPref(Exper(n).Test(3).Stim.Disparity,Exper(n).Test(3).Tun(m).Resp);
		else
			prefDispar = DisparPref(Exper(n).Test(3).Stim.HoriDisparity,Exper(n).Test(3).Tun(m).Resp);
		end
		
		if ~isempty(Exper(n).Test(5).FileData)
			clust_idx_phi = [Exper(n).Test(5).Tun.clust_idx];
			idx_phi = find(clust_idx_phi==clust_idx_dispar(m));
			TunPhi = zeros(8,4);
			TunPhi(:,1) = squeeze(Exper(n).Test(5).Tun(idx_phi).Resp(1:8,1));
			TunPhi(:,2) = squeeze(Exper(n).Test(5).Tun(idx_phi).Resp(9:16,1));
			TunPhi(:,3) = squeeze(Exper(n).Test(5).Tun(idx_phi).Resp(17:24,1));
			TunPhi(:,4) = squeeze(Exper(n).Test(5).Tun(idx_phi).Resp(25:32,1));
			[~,oriid] = max(max(TunPhi));
			[~,~,~,PDSI]  = prefDOgOSIgDSI(TunPhi(:,oriid));
		else
			PDSI = -1;
		end
		
% 		if n ~= 2
			Data = [Data; ...
				n Tun(m).clust_idx Tun(m).Anova DDI BII NeurPos mean(zbnd) monoc spk_ptratio spk_slope gOSI prefO prefDispar RDomEye TunOri(m).Resp(end,1) Amp PDSI];
% 				n Tun(m).clust_idx NeurPos mean(zbnd) monoc spk_ptratio spk_slope gOSI prefO RDomEye TunOri(m).Resp(end,1)];
% 		end
	end
end

figure;
SIGNIF = Data(:,3)<0.05;
% oh(1) = plot(Data(~SIGNIF,18),Data(~SIGNIF,4),'o'); hold on;
% oh(2) = plot(Data( SIGNIF,18),Data( SIGNIF,4),'o');
oh(1) = plot(Data(~SIGNIF,7)-Data(~SIGNIF,9),Data(~SIGNIF,4),'o'); hold on;
oh(2) = plot(Data( SIGNIF,7)-Data( SIGNIF,9),Data( SIGNIF,4),'o');
oh(2).Color = oh(1).Color;
oh(1).MarkerFaceColor = 'w';
oh(2).MarkerFaceColor = oh(2).Color;
xlabel('Depth from sink (\mu m)'); ylabel('Binoc Interact Indx'); box off;

disp('hello');
end



